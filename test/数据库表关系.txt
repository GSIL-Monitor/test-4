###
�ز���صı�
select * from expert_info where name in('������','�Ծ�ƽ');
120162:������
510070:����ϰ�

120170:�Ծ�ƽ
510019
ѧ�ƣ���������ѧ
select * from expert_prop_val where PROPID=510019 and EXPERTID=120170;----ר��ѧ��
510019:��������ѧ
510070:����ϰ�

select * from exam_prop_val where name in('����ϰ�','��������ѧ','��Ⱦ��ѧ');

select * from exam_icd_prop where name='����ϰ�';



select * from material_info where id>=3903934;---�زĵĴ����ˣ�     expertname��


SELECT * from material_prop_val where material_id >=3903935;


select material_id from material_prop_val where PROP_ID not in(select epv.PROPID from expert_prop_val epv,expert_info ei where epv.EXPERTID=ei.ID and ei.USERNAME='zhaojingping')


select * from system_account where account_id=21669

select *  from material_info where id>0  and creatorid !=21669 and state = 2  order by id desc limit 0, 20



select *  from material_info where id>0  and creatorid !=21669 and state = 2 
and id not in (select material_id from material_prop_val where PROP_ID  in(select epv.PROPID from expert_prop_val epv,expert_info ei where epv.EXPERTID=ei.ID and ei.USERNAME='zhaojingping'))

 order by id desc limit 0, 20


select material_id,PROP_ID from material_prop_val where PROP_ID  in(select epv.PROPID from expert_prop_val epv,expert_info ei where epv.EXPERTID=ei.ID and ei.USERNAME='zhaojingping')



select *  from material_info where id=3303909


select  *  from material_prop_val where material_id=3303909

select  * from expert_prop_val where  EXPERTID=120170;


select * from expert_info where name in('������','�Ծ�ƽ');


select * from system_account where account_id=21669 and ACCOUNT_NAME='zhaojingping';

select * from system_user where id=21669;

select * from system_experts  where user_id=21669;


select PROPID from expert_prop_val where PROPID=510019 and EXPERTID=(select id from expert_info where USERNAME='zhaojingping');

select epv.PROPID from expert_prop_val epv,expert_info ei where epv.EXPERTID=ei.ID and ei.USERNAME='zhaojingping'


###

����Ӧ�ı�
SELECT DISTINCT
	t.id,
	t.question_label_id,
	t.parent_id,
	t.content,
	t.state,
	t.grade,
	t.differ,
	t.analyse,
	t.source,
	t.seq,
	DATE_FORMAT(
		t.create_date,
		'%Y-%m-%d %H:%i:%S'
	) AS create_date,
	t.author,
	t.checker,
	DATE_FORMAT(
		t.online_date,
		'%Y-%m-%d %H:%i:%S'
	) AS online_date,
	t.surname,
	t.opinion
FROM
	exam_question t,
	exam_question_type t1,
	exam_sys_quest_type_quest t2
WHERE
	t.id = t2.question_id
AND t1.id = t2.sub_type_id
AND t.parent_id = 0
AND t2.state = 1

and t.AUTHOR!='zhaojingping'
AND t.id NOT IN (
	SELECT
		question_id
	FROM
		exam_question_unit
	WHERE
		prop_val_id IN (
			SELECT
				epv.PROPID
			FROM
				expert_prop_val epv,
				expert_info ei
			WHERE
				epv.EXPERTID = ei.ID
			AND ei.USERNAME ='zhaojingping'
		)
)
;
  and t.AUTHOR!=? and t.id not in (select question_id from exam_question_unit where prop_val_id  in(select epv.PROPID from expert_prop_val epv,expert_info ei where epv.EXPERTID=ei.ID and ei.USERNAME=?))

and t.id not in (select question_id from exam_question_unit where prop_val_id  in(select epv.PROPID from expert_prop_val epv,expert_info ei where epv.EXPERTID=ei.ID and ei.USERNAME=?))

select * from exam_question order by id desc;4117889

select * from exam_question_unit where question_id=4117889;


select * from exam_prop_val where id in(510038,510041);


AND t.id NOT IN (
	SELECT
		question_id
	FROM
		exam_question_unit
	WHERE
		prop_val_id IN (
			SELECT
				epv.PROPID
			FROM
				expert_prop_val epv,
				expert_info ei
			WHERE
				epv.EXPERTID = ei.ID
			AND ei.USERNAME ='zhaojingping'
		)
)
###########
������صı�

SELECT DISTINCT
			c.*, CONVERT (p.id USING gbk)
		FROM
			CASE_CASE c
		LEFT JOIN CASE_PATIENT p ON c.P_ID = p.ID
		LEFT JOIN CASE_PATIENT_DIAGNOSIS d ON p.ID = d.patientid
		LEFT JOIN CASE_PATIENT_PROP_VAL v ON v.patientid = p.id
		LEFT JOIN CASE_PATIENT_PROP_VAL vv ON vv.patientid = p.id
		LEFT JOIN CASE_PATIENT_PROP_VAL vvv ON vvv.patientid = p.id
		WHERE
			p.ID > 0
		AND c.state != 5
		AND c.P_ID IN (
			SELECT
				patientid
			FROM
				CASE_PATIENT_PROP_VAL
			WHERE
				propID IN (
					SELECT
						epv.PROPID
					FROM
						expert_prop_val epv,
						expert_info ei
					WHERE
						epv.EXPERTID = ei.ID
					AND ei.USERNAME = 'zhaojingping'
				)
		)
		AND c.STATE = '1'
		AND c.creator != 21669
		ORDER BY
			p.id DESC


select *  from material_info where id>0 and creatorid !='linyunfei' and state = 2 and id in (select material_id from material_prop_val where prop_id in (510035) or creatorid ='linyunfei' )



SELECT
	*
FROM
	material_info
WHERE
	id > 0
AND id IN (
	SELECT
		material_id
	FROM
		material_prop_val
	WHERE
		PROP_ID IN (
			SELECT
				epv.PROPID
			FROM
				expert_prop_val epv,
				expert_info ei
			WHERE
				epv.EXPERTID = ei.ID
			AND ei.USERNAME ='zhaojingping'
		)
)
AND creatorid !=21669
AND state = 2
ORDER BY
	id DESC；
	
	
	select *  from material_info where id>0 AND state = 2 and id in (select material_id from material_prop_val where prop_id in (510035) or creatorid ='linyunfei' ) order by id desc;



SELECT
	*
FROM
	material_info
WHERE
	id > 0

AND creatorid !=21640
AND state = 2
AND id IN (
	SELECT
		material_id
	FROM
		material_prop_val
	WHERE
		prop_id IN (510035)
	OR creatorid ='linyunfei'
)
ORDER BY
	id DESC
	
	
	
	


SELECT
	t.*, s.type_name AS typename
FROM
	exam_source_val t
LEFT JOIN exam_source_type s ON t.type = s.id
WHERE
	t. NAME LIKE '%'
AND t.id IN (
	SELECT
		sourceid
	FROM
		EXAM_SOURCE_PROP_VAL
	WHERE
		PROPID IN (510018)
)
AND t.state = 1
ORDER BY
	t.id DESC ;



SELECT
		DISTINCT PROPID
	FROM
		EXAM_SOURCE_PROP_VAL ORDER BY  PROPID desc ;



SELECT
	t.id
FROM
	exam_source_val t
LEFT JOIN exam_source_type s ON t.type = s.id order by t.id desc ;




select t.*,v.id as prop_val_id from exam_prop_val t,sub_sys_prop_val v where t.id = v.prop_val_id and v.id = 510018;




select * from material_info where FILENAME='房颤导管消融围术期抗凝--拜瑞妥';

查看素材是否被引用
select  * FROM  group_class_info where class_content like '%房颤导管消融围术期抗凝--拜瑞妥%';


select * from material_prop_val  where material_id=3904399


select * from cv_unit where id=4209572


SELECT
	*
FROM
	material_info
WHERE
	id > 0

AND creatorid !=21640
AND state = 2
AND id IN (
	SELECT
		material_id
	FROM
		material_prop_val
	WHERE
		prop_id IN (510035)
	OR creatorid ='linyunfei'
)
ORDER BY
	id DESC



select * from group_class_info where media_type='paper'

and media_id in(
select exam_id from  exam_exam_paper  where paper_id=3300343
);




、、、、、、、、、、、、、、、、、、、、

试卷和单元的关系
SELECT
	count(*)
FROM
	group_class_info
WHERE
	media_type = 'paper'
AND media_id IN (
	SELECT
		EXAM_ID
	FROM
		exam_exam_paper
	WHERE
		PAPER_ID = 3900343
)；



select  * from group_class_info  where class_name='手工组卷';



select * from exam_exam_paper




select * from group_class_info

select * from cv_unit_ref_quality  where parent_prop_id=260 and unit_id=4202461;


select * from  cv_unit_ref_source where UNIT_ID=0
delete from cv_unit_ref_source where UNIT_ID=0

select * from cv  where id=4202462;

insert into cv_unit_ref_source (UNIT_ID,SOURCE_ID) select 0,
  SOURCE_ID from cv_unit_ref_source where UNIT_ID in(
select UNIT_ID from cv_ref_unit where CV_ID=4202478);

4202478

4202462

select UNIT_ID from cv_ref_unit where CV_ID=4202462

insert into cv_unit_ref_source (UNIT_ID,SOURCE_ID) select 0,SOURCE_ID from cv_unit_ref_source where UNIT_ID in(select UNIT_ID from cv_ref_unit where CV_ID=4202478)







select * from cv  where name ='面授1';
select * from cv where id =4202461;


select * from cv_unit_ref_quality where UNIT_ID=4202462;




select * from cv_unit where ID in (4209191,4200566);

select * from  cv_set where id=4200566

select * from cv  where id=4202461;

select * from cv_ref_unit where UNIT_ID=4202461;
select count(1), UNIT_ID from cv_unit_ref_source  GROUP BY UNIT_ID




select * from cv  where id=4202478


select * from cv_unit_ref_source  where UNIT_ID in(

select UNIT_ID from cv_ref_unit where cv_id=4202478);



select * from cv_ref_unit where cv_id=4202478

select * from group_class_info

select * from cv_ref_unit where UNIT_ID=4209191;
select * from cv_unit where ID=4209191;
select * from cv_unit_ref_source  where UNIT_ID=4209191;

select * from exam_source_val where id=600492;


select * from CV_SCHEDULE where CV_ID=4202460;



select * from cv_unit_ref_source where UNIT_ID=4209191;






下一步


select * from CV_SET_SCHEDULE where    cv_SCHEDULE_ID  in (4207552,4207566,4207582)

select * from cv_unit_ref_source  where UNIT_ID=4202462;


select * from exam_source_val where id=4200566;




/***/clone('4202462','4200566');


select * from CV_SCHEDULE where CV_ID=4202462;
//通过项目找到计划，通过计划找到课程

select * from CV_SET_SCHEDULE where    cv_SCHEDULE_ID  in (4207584);


select  * from cv_set where id=4200551;

select * from CV_SET_SCHEDULE where CV_SET_ID=4202462

	解除用户锁定
update system_user set login_error_num=0,login_error_first_time=0,login_error_last_time=0 where id=20
	

解除微信账号绑定
把system_account 的openid 清空

账号登录运行错误次数和时间：

select * from system_user where  mobil_phone like '%18810610795%';
update  system_user  set login_error_num=0,login_error_first_time=0,login_error_last_time=0 where id=3925293
update system_login_limit  set login_num =3,lock_time=1


select * from system_user where  mobil_phone like '%18810610795%';
update  system_user  set login_error_num=0,login_error_first_time=0,login_error_last_time=0 where id=4525245
update system_login_limit  set login_num =3,lock_time=1

####

人物画像
SELECT DISTINCT
	t.*
FROM
	QM_USER_IMAGE t
LEFT JOIN QM_USER_IMAGE_PROP t1 ON t.ID = t1.USERIMAGE_ID
LEFT JOIN QM_USER_IMAGE_GENERAL_PROP t2 ON t.ID = t2.IMAGE_ID
LEFT JOIN QM_USER_IMAGE_SPECIAL_PROP t3 ON t.ID = t3.IMAGE_ID
WHERE
	t.id > 0
AND t.TYPEID in(98954,98957)
	